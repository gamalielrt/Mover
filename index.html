<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>harpsichordpoint</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <script src="js/three.js"></script>
    <script src="js/MTLLoader.js"></script>
    <script src="js/OBJLoader.js"></script>
    <script>
        var scene, camera, renderer, mesh, 
        objLoader, mtlLoader, GLTFLoader, keyLight, 
        fillLight, backLight, testLight, testLight1, 
        light1, sphereGeometry, sphereMaterial, 
        sphere, planeGeometry, planeMaterial, plane, textureloader, loader ;
        

        var meshFloor;

        var keyboard = {};
        var player = { height:450, speed:5, turnSpeed:Math.PI*0.01 };
        var USE_WIREFRAME = false;
        var lightColour = 0x8a6222;
        var lightDistance = 3;
        var lightDecay = 350;

        function init(){
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 3000 );
          
            //barright
            testLight = new THREE.PointLight(lightColour, lightDistance, lightDecay);//1, 750
            testLight.position.set(480,520,90);
            //testLight.castShadow = true;
            testLight.shadow.camera.near = 100;
            testLight.shadow.camera.far = 1000;

            scene.add(testLight);
            //harpright
            testLight1 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight1.position.set(-140,520,490);
            //testLight1.castShadow = true;
            testLight1.shadow.camera.near = 100;
            testLight1.shadow.camera.far = 1000;

            scene.add(testLight1);

            //barleft
            testLight3 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight3.position.set(100,520,490);
            //testLight3.castShadow = true;
            testLight3.shadow.camera.near = 100;
            testLight3.shadow.camera.far = 1000;

            scene.add(testLight3);

            //harpright
            testLight4 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight4.position.set(-540,520,110);
            //testLight4.castShadow = true;
            testLight4.shadow.camera.near = 100;
            testLight4.shadow.camera.far = 1000;

            scene.add(testLight4);

            //barwall
            testLight5 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight5.position.set(480,520,-165);
            //testLight5.castShadow = true;
            testLight5.shadow.camera.near = 100;
            testLight5.shadow.camera.far = 1000;

            scene.add(testLight5);

            var spotLight = new THREE.SpotLight(0xffffff, 1);
            //spotLight.intensity = 0.7;
            spotlight.distance = 300;
            //spotlight.angle = Math.PI/4;
            //spotlight.penumbra = 300;
            //spotlight.distance = 0.5;
            //spotLight.decay = 2;
            //spotLight.position.set(0,580,0);
            //spotLight.rotation.z = 1;
            scene.add(spotLight);
            lightHelper = new THREE.SpotLightHelper( spotLight );
			scene.add( lightHelper );


            mtlLoader = new THREE.MTLLoader();

            textureLoader = new THREE.TextureLoader();
            var wartex = textureLoader.load('assets/waxworkrecords-03.jpg');
            var floortex = textureLoader.load('assets/floor_tex.jpg');
            var floordis = textureLoader.load('assets/floor_dis2.jpg');
            var walltex = textureLoader.load('assets/wall_tex2.jpg');
            var ceilingtex = textureLoader.load('assets/ceilingtex.jpg');
            var stagetex = textureLoader.load('assets/stagetex.jpg');

            walltex.wrapS = THREE.RepeatWrapping;
            walltex.wrapT = THREE.RepeatWrapping;
            walltex.repeat.set(2,2);
            stagetex.wrapS = THREE.RepeatWrapping;
            stagetex.wrapT = THREE.RepeatWrapping;
            stagetex.repeat.set(2,2);
            
            /*mtlLoader.load("assets/bar_floor10.mtl", function(materials3){
                
                materials3.preload();

                objLoader = new THREE.OBJLoader();
                objLoader.setMaterials(materials3);
                objLoader = new THREE.OBJLoader();
        
                objLoader.load('assets/bar_floor10.obj', function(object){
                    object.position.y = 300;

                    object.traverse( function(child) {
                        if (child instanceof THREE.Mesh) {

                            child.receiveShadow = true;
                        }
                    })
                    scene.add(object);
                });
            });*/

            mtlLoader = new THREE.MTLLoader();
            mtlLoader.load("assets/warriorcube.mtl", function(materials){
                    
                materials.preload();
                objLoader = new THREE.OBJLoader();
                objLoader.setMaterials(materials);
                    
                objLoader.load("assets/warriorcube.obj", function(mesh){
                    
                    mesh.traverse(function(node){
                        if( node instanceof THREE.Mesh ){
                            node.castShadow = true;
                            node.receiveShadow = true;
                        }
                    });
                    mesh.rotation.y = 70;
                    mesh.scale.set(0.25,0.25,0.25);
                    mesh.position.set(-350,420,320); 
                        
                    colourcube = mesh;
                    //scene.add(colourcube);


                });
                    
            });
            var plane = new THREE.PlaneGeometry(1200,1200,10,10);
            var floormtl = new THREE.MeshStandardMaterial();
            floormtl.map = floortex;
            floormtl.colour = 0x000000;
            floormtl.displacementMap = floordis;
            floormtl.displacementScale = 3;
            floormtl.displacementBias = 1;
            floormtl.metalness = 0.3;
            floormtl.roughness = 1;
            var floorplane = new THREE.Mesh(plane, floormtl);
            floorplane.position.y = 300;  
            floorplane.rotation.x = -Math.PI/2; 
            floorplane.receiveShadow = true;
            scene.add(floorplane);         
            



            /*// Create a material
            var floormtl = new THREE.MeshPhongMaterial({map: wartex});

            loader = new THREE.OBJLoader();
            loader.load( 'assets/bar_floor10.obj', function ( object3 ) {


                // For any meshes in the model, add our material.
                object3.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = floormtl;
                    

            } );

            // Add the model to the scene.
            object3.position.y = 300;
            scene.add( object3 );
            });*/

            // Create a material
            var wallmtl = new THREE.MeshPhongMaterial({
                map : walltex,
                shininess : 0,
                color: 0x191919

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/walls1.obj', function ( wallsmesh ) {
                            

                // For any meshes in the model, add our material.
                wallsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = wallmtl;             
                    node.castShadow = true;                       
                    node.receiveShadow = true;
                } );

                // Add the model to the scene.
                wallsmesh.position.y = 300;
                scene.add( wallsmesh );
            });

            var tableschairsmtl = new THREE.MeshPhongMaterial({
                //map : walltex,
                shininess : 40,
                color: 0x332000,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/tableschairs2.obj', function ( tableschairsmesh ) {
                            

                // For any meshes in the model, add our material.
                tableschairsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = tableschairsmtl;             
                    node.castShadow = true;
                } );

                // Add the model to the scene.
                tableschairsmesh.position.y = 290;
                scene.add( tableschairsmesh );
            });

            var ceilingmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/ceiling4.obj', function ( ceilingmesh ) {
                            

                // For any meshes in the model, add our material.
                ceilingmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = ceilingmtl;             

                } );

                // Add the model to the scene.
                ceilingmesh.position.y = 300;
                scene.add( ceilingmesh );
            });

            var fixturemtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/fixtures.obj', function ( fixturemesh ) {
                            

                // For any meshes in the model, add our material.
                fixturemesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = fixturemtl;             

                } );

                // Add the model to the scene.
                fixturemesh.position.y = 300;
                scene.add( fixturemesh );
            });



                        var barfixturesmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/barfixtures.obj', function ( barfixturesmesh ) {
                            

                // For any meshes in the model, add our material.
                barfixturesmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = barfixturesmtl;             

                } );

                // Add the model to the scene.
                barfixturesmesh.position.y = 300;
                scene.add( barfixturesmesh );
            }); 

                var bartopmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/bartop.obj', function ( bartopmesh ) {
                            

                // For any meshes in the model, add our material.
                bartopmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = bartopmtl;             

                } );

                // Add the model to the scene.
                bartopmesh.position.y = 300;
                scene.add( bartopmesh );
            }); 

                var lighttopsmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/lighttops.obj', function ( lighttopsmesh ) {
                            

                // For any meshes in the model, add our material.
                lighttopsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = lighttopsmtl;             
                    node.castShadow = true;
                    node.receiveShadow = true;
                } );

                // Add the model to the scene.
                lighttopsmesh.position.y = 300;
                scene.add( lighttopsmesh );
            });

                var mirrorsmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/mirrors.obj', function ( mirrorsmesh ) {
                            

                // For any meshes in the model, add our material.
                mirrorsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = mirrorsmtl;             

                } );

                // Add the model to the scene.
                mirrorsmesh.position.y = 300;
                scene.add( mirrorsmesh );
            });  

                var lightfittingsmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/lightfittings.obj', function ( lightfittingsmesh ) {
                            

                // For any meshes in the model, add our material.
                lightfittingsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = lightfittingsmtl;             

                } );

                // Add the model to the scene.
                lightfittingsmesh.position.y = 300;
                scene.add( lightfittingsmesh );
            });  

                var discoballmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/discoball.obj', function ( discoballmesh ) {
                            

                // For any meshes in the model, add our material.
                discoballmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = discoballmtl;             

                } );

                // Add the model to the scene.
                discoballmesh.position.y = 300;
                scene.add( discoballmesh );
            });  
            var harpsichordmtl = new THREE.MeshStandardMaterial({
                //map : ceilingtex,
                //envMap : ceilingtex,
                roughness : 0,
                metalness : 1,
                color: 0xffffff,
                shininess : 1,
                //refractionRatio : 0.5,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/harpsichord.obj', function ( harpsichordmesh ) {
                            

                // For any meshes in the model, add our material.
                harpsichordmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = harpsichordmtl;             

                } );

                // Add the model to the scene.
                harpsichordmesh.position.y = 300;
                scene.add( harpsichordmesh );
            });    

                var curtainmtl = new THREE.MeshStandardMaterial({
                map : ceilingtex,
                metalness: 0,
                roughness : 1,
                color: 0x4B0000,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/curtain.obj', function ( curtainmesh ) {
                            

                // For any meshes in the model, add our material.
                curtainmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = curtainmtl;             

                } );

                // Add the model to the scene.
                curtainmesh.position.y = 300;
                scene.add( curtainmesh );
            });  

                var airconmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/aircon.obj', function ( airconmesh ) {
                            

                // For any meshes in the model, add our material.
                airconmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = airconmtl;             

                } );

                // Add the model to the scene.
                airconmesh.position.y = 300;
                scene.add( airconmesh );
            });  

            var stagemtl = new THREE.MeshPhongMaterial({
            //map : stagetex
            //shininess : 0,
            color: 0x1c1c1c,
            //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/stage.obj', function ( stagemesh ) {
                            

                // For any meshes in the model, add our material.
                stagemesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = stagemtl;             

                } );

                // Add the model to the scene.
                stagemesh.position.y = 300;
                scene.add( stagemesh );
            });  

          
            
            camera.position.set(-500, player.height, -5);
            camera.lookAt(new THREE.Vector3(0,player.height,0));
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            renderer.setSize( window.innerWidth, window.innerHeight );
            
            document.body.appendChild(renderer.domElement);
            
            animate();
        };

        function animate(){
            requestAnimationFrame(animate);

            //colourcube.rotation.x += 0.01;
            //colourcube.rotation.y += 0.01;
            
            // Keyboard movement inputs
            if(keyboard[87]){ // W key
                camera.position.x -= Math.sin(camera.rotation.y) * player.speed;
                camera.position.z -= -Math.cos(camera.rotation.y) * player.speed;
            }
            if(keyboard[83]){ // S key
                camera.position.x += Math.sin(camera.rotation.y) * player.speed;
                camera.position.z += -Math.cos(camera.rotation.y) * player.speed;
            }
            if(keyboard[65]){ // A key
                // Redirect motion by 90 degrees
                camera.position.x += Math.sin(camera.rotation.y + Math.PI/2) * player.speed;
                camera.position.z += -Math.cos(camera.rotation.y + Math.PI/2) * player.speed;
            }
            if(keyboard[68]){ // D key
                camera.position.x += Math.sin(camera.rotation.y - Math.PI/2) * player.speed;
                camera.position.z += -Math.cos(camera.rotation.y - Math.PI/2) * player.speed;
            }
            
            // Keyboard turn inputs
            if(keyboard[37]){ // left arrow key
                camera.rotation.y -= player.turnSpeed;
            }
            if(keyboard[39]){ // right arrow key
                camera.rotation.y += player.turnSpeed;
            }
            
            renderer.render(scene, camera);
        }

        function keyDown(event){
            keyboard[event.keyCode] = true;
        }

        function keyUp(event){
            keyboard[event.keyCode] = false;
        }

        window.addEventListener('keydown', keyDown);
        window.addEventListener('keyup', keyUp);

        window.onload = init;
        

    </script>
</body>
</html>