<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sweatnet.net</title>
    <link rel="stylesheet" href="main.css">

</head>
<body>
    <div id="overlay">
        <div>
            <button id="startButton">Click to Play</button>
            <p>Video playback with audio requires user interaction.</p>
        </div>
    </div>
    <body style="background-color:#000000;">
    <script src="js/three.js"></script>
    <script src="js/MTLLoader.js"></script>
    <script src="js/OBJLoader.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/0.7.19/ua-parser.min.js"></script>
    <video id="videoalpha" loop crossOrigin="anonymous" playsinline style="display:none">
        <source src="assets/shave1.webm" type='video/webm; codecs="vp8, vorbis"'>
    </video>

    <video id="video" loop crossOrigin="anonymous" playsinline style="display:none">
        <source src="assets/shavevid.webm" type='video/webm; codecs="vp8, vorbis"'>
    </video>

    <script>

        




        var scene, camera, renderer, mesh, 
        objLoader, mtlLoader, GLTFLoader, keyLight, 
        fillLight, backLight, testLight, testLight1, 
        light1, sphereGeometry, sphereMaterial, 
        sphere, planeGeometry, planeMaterial, plane, textureloader, loader, fanblade ;
        

        var meshFloor;
        var onHandset = true;
        var keyboard = {};
        var player = { height:450, speed:5, turnSpeed:Math.PI*0.01 };
        var USE_WIREFRAME = false;
        var lightColour = 0xD98400;
        var lightDistance = 3; //3
        var lightDecay = 280; //280
        var StageLightColour = 0xc603fc;
        var StageLightDistance = 2; //3
        var StageLightDecay = 25; //350
        var spotLightintensity = 2;
        var spotLightangle = 0.3;
        var spotLightpenumbra = 0.5;
        var spotLightdistance = 0;
        var spotLightdecay = 0;


        function init(){

            //window.addEventListener('touchstart', function() {
            //    //the user touched the screen!
            //    onHandset = true
            //})


            //if (window.DeviceOrientationEvent) {
            //onHandset = true
            //}

            var overlay = document.getElementById( 'overlay' );
			overlay.remove();

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 0.1, 3000 );
          
            //barright
            testLight = new THREE.PointLight(lightColour, lightDistance, lightDecay);//1, 750
            testLight.position.set(490,520,90);
            //testLight.castShadow = true;
            testLight.shadow.camera.near = 100;
            testLight.shadow.camera.far = 1000;

            scene.add(testLight);
            var sphereSize = 40;
            var pointLightHelper = new THREE.PointLightHelper( testLight, sphereSize );
            //scene.add( pointLightHelper );
            
            //harpright
            testLight1 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight1.position.set(-150,520,482);
            //testLight1.castShadow = true;
            testLight1.shadow.camera.near = 100;
            testLight1.shadow.camera.far = 1000;

            scene.add(testLight1);

            
            //barleft
            testLight3 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight3.position.set(112,520,482);
            //testLight3.castShadow = true;
            testLight3.shadow.camera.near = 100;
            testLight3.shadow.camera.far = 1000;

            scene.add(testLight3);
            var sphereSize = 40;
            var pointLightHelper = new THREE.PointLightHelper( testLight3, sphereSize );
            //scene.add( pointLightHelper );

            //harpleft
            testLight4 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight4.position.set(-540,520,110);
            //testLight4.castShadow = true;
            testLight4.shadow.camera.near = 100;
            testLight4.shadow.camera.far = 1000;

            scene.add(testLight4);
            var sphereSize = 40;
            var pointLightHelper = new THREE.PointLightHelper( testLight4, sphereSize );
            //scene.add( pointLightHelper );

            //barwall
            testLight5 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight5.position.set(490,520,-160);
            //testLight5.castShadow = true;
            testLight5.shadow.camera.near = 100;
            testLight5.shadow.camera.far = 1000;

            scene.add(testLight5);
            var sphereSize = 40;
            var pointLightHelper = new THREE.PointLightHelper( testLight5, sphereSize );
            //scene.add( pointLightHelper );

            //farwall
            testLight6 = new THREE.PointLight(lightColour, lightDistance, lightDecay);//750
            testLight6.position.set(100,520,-545);
            //testLight6.castShadow = true;
            testLight6.shadow.camera.near = 100;
            testLight6.shadow.camera.far = 1000;

            scene.add(testLight6);
            var sphereSize = 40;
            var pointLightHelper = new THREE.PointLightHelper( testLight6, sphereSize );
            //scene.add( pointLightHelper );

            //farwall
            testLight7 = new THREE.PointLight(lightColour, 3, 100);//750
            testLight7.position.set(-30,550,-50);
            //testLight6.castShadow = true;
            testLight7.shadow.camera.near = 100;
            testLight7.shadow.camera.far = 1000;

            scene.add(testLight7);
            var sphereSize = 40;
            var pointLightHelper = new THREE.PointLightHelper( testLight7, sphereSize );
            //scene.add( pointLightHelper );


            //stageLight1 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight2 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight3 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight4 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight5 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight6 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight7 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight8 = new THREE.PointLight(StageLightColour, StageLightDistance, StageLightDecay);
            //stageLight1.position.set(-498, 307, 100);
            //stageLight2.position.set(-420, 307, 110);
            //stageLight3.position.set(-346, 307, 138);
            //stageLight4.position.set(-281, 307, 183);
            //stageLight5.position.set(-229, 307, 242);
            //stageLight6.position.set(-192, 307, 311);
            //stageLight7.position.set(-173, 307, 388);
            //stageLight8.position.set(-173, 307, 467);
//
            //
            //scene.add(stageLight1, stageLight2, stageLight3, stageLight4, stageLight5, stageLight6, stageLight7, stageLight8); 
            
            //stageLight1 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight2 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight3 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight4 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight5 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight6 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight7 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight8 = new THREE.SpotLight(StageLightColour, spotLightintensity)//, StageLightDistance);
            //stageLight1.position.set(-498, 313, 100);
            //stageLight2.position.set(-420, 313, 110);
            //stageLight3.position.set(-346, 313, 138);
            //stageLight4.position.set(-281, 313, 183);
            //stageLight5.position.set(-229, 313, 242);
            //stageLight6.position.set(-192, 313, 311);
            //stageLight7.position.set(-173, 313, 388);
            //stageLight8.position.set(-173, 313, 467);
//
            //scene.add(stageLight1, stageLight2, stageLight3, stageLight4, stageLight5, stageLight6, stageLight7, stageLight8);                      

            //spotLight.intensity = 2;
            //spotLight.angle = 0.3;
            //spotLight.penumbra = 0.5;
            //spotLight.distance = 0;
            //spotLight.decay = 0;
            //spotLight.target.position.set(-900, 0, 900);
            //scene.add(spotLight);
            //scene.add(spotLight.target);
            //lightHelper = new THREE.SpotLightHelper( spotLight );
			//scene.add( lightHelper );
   

            var spotLight = new THREE.SpotLight(0xffffff);
            spotLight.intensity = 2;
            spotLight.angle = 0.3;
            spotLight.penumbra = 0.5;
            spotLight.distance = 1;
            spotLight.decay = 0;
            spotLight.position.set(0,700,0);
            spotLight.target.position.set(-900, 0, 900);
            //spotlight.target.position.set(200,-130,400);
            scene.add(spotLight);
            scene.add(spotLight.target);
            lightHelper = new THREE.SpotLightHelper( spotLight );
			//scene.add( lightHelper );


            mtlLoader = new THREE.MTLLoader();

            textureLoader = new THREE.TextureLoader();
            var floortex = textureLoader.load('assets/floor_tex.jpg');
            var floordis = textureLoader.load('assets/floor_dis2.jpg');
            var walltex = textureLoader.load('assets/wall_tex2.jpg');
            var ceilingtex = textureLoader.load('assets/ceilingtex.jpg');
            var curtaintex = textureLoader.load('assets/ceilingtex.jpg');
            var stagetex = textureLoader.load('assets/stagetex.jpg');
            var video;
            //var discoballreflec = textureLoader.load('assets/discoballreflec.jpg');

            walltex.wrapS = THREE.RepeatWrapping;
            walltex.wrapT = THREE.RepeatWrapping;
            walltex.repeat.set(40,40);
            stagetex.wrapS = THREE.RepeatWrapping;
            stagetex.wrapT = THREE.RepeatWrapping;
            stagetex.repeat.set(40,40);
            ceilingtex.wrapS = THREE.RepeatWrapping;
            ceilingtex.wrapT = THREE.RepeatWrapping;
            ceilingtex.repeat.set(20,20);
            

            var plane = new THREE.PlaneGeometry(1200,1200,10,10);
            var floormtl = new THREE.MeshStandardMaterial();
            floormtl.map = floortex;
            floormtl.colour = 0x000000;
            floormtl.displacementMap = floordis;
            floormtl.displacementScale = 3;
            floormtl.displacementBias = 1;
            floormtl.metalness = 0.3;
            floormtl.roughness = 1;
            var floorplane = new THREE.Mesh(plane, floormtl);
            floorplane.position.y = 300;  
            floorplane.rotation.x = -Math.PI/2; 
            floorplane.receiveShadow = true;
            scene.add(floorplane);    

            
            
            video = document.getElementById( 'video' );
            video.load();
			video.play();
            var vidplane = new THREE.PlaneGeometry(300,300,10,10);
            var vidtexture = new THREE.VideoTexture( video );

            videoalpha = document.getElementById( 'videoalpha' );
            videoalpha.load();
			videoalpha.play();
            var vidalphatexture = new THREE.VideoTexture( videoalpha );
            
            var vidplanemtl = new THREE.MeshStandardMaterial();
            vidplanemtl.map = vidtexture;
            vidplanemtl.alphaTest = 0.5;
            vidplanemtl.alphaMap = vidalphatexture;


            var vidplanemesh = new THREE.Mesh(vidplane, vidplanemtl);
            vidplanemesh.position.set(-400, 450, 300);
            vidplanemesh.rotation.y = 2.3;
            scene.add(vidplanemesh);  

            var sphere = new THREE.SphereBufferGeometry();
            var box = new THREE.BoxHelper( vidplanemesh, 0xffff00 );
            //scene.add( box );


            // Create a material
            var wallmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x191919

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/newwalls9.obj', function ( wallsmesh ) {
                            

                // For any meshes in the model, add our material.
                wallsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = wallmtl;             
                    node.castShadow = true;                       
                    node.receiveShadow = true;
                } );

                // Add the model to the scene.
                wallsmesh.position.y = 300;
                scene.add( wallsmesh );
            });

            var tableschairsmtl = new THREE.MeshStandardMaterial({
                //map : walltex,
                metalness : 3,
                roughness : 0.6,
                color: 0x6E6E6E,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/tableschairs4.obj', function ( tableschairsmesh ) {
                            

                // For any meshes in the model, add our material.
                tableschairsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = tableschairsmtl;             
                    node.castShadow = true;
                } );

                // Add the model to the scene.
                tableschairsmesh.position.y = 297;
                scene.add( tableschairsmesh );
            });
            

            var ceilingmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/ceiling2.obj', function ( ceilingmesh ) {
                            

                // For any meshes in the model, add our material.
                ceilingmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = ceilingmtl;             

                } );

                // Add the model to the scene.
                ceilingmesh.position.y = 300;
                scene.add( ceilingmesh );
            });

            var fixturemtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/fixtures.obj', function ( fixturemesh ) {
                            

                // For any meshes in the model, add our material.
                fixturemesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = fixturemtl;             

                } );

                // Add the model to the scene.
                fixturemesh.position.y = 300;
                scene.add( fixturemesh );
            });



                        var barfixturesmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/barfixtures.obj', function ( barfixturesmesh ) {
                            

                // For any meshes in the model, add our material.
                barfixturesmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = barfixturesmtl;             

                } );

                // Add the model to the scene.
                barfixturesmesh.position.y = 300;
                scene.add( barfixturesmesh );
            }); 

                var bartopmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 30,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/bartop.obj', function ( bartopmesh ) {
                            

                // For any meshes in the model, add our material.
                bartopmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = bartopmtl;             

                } );

                // Add the model to the scene.
                bartopmesh.position.y = 300;
                scene.add( bartopmesh );
            }); 

                var lighttopsmtl = new THREE.MeshPhongMaterial({
                //map : ceilingtex,
                shininess : 0,
                transparent : true,
                opacity : 1,
                color: 0xFF9300,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/lighttopsnew1.obj', function ( lighttopsmesh ) {
                            

                // For any meshes in the model, add our material.
                lighttopsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = lighttopsmtl;             
                    node.castShadow = true;
                    node.receiveShadow = true;
                } );

                // Add the model to the scene.
                lighttopsmesh.position.y = 300;
                scene.add( lighttopsmesh );
            });

                var mirrorsmtl = new THREE.MeshPhongMaterial({
                shininess : 10,
                transparent : true,
                opacity : 0.4,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/tabletops.obj', function ( mirrorsmesh ) {
                            

                // For any meshes in the model, add our material.
                mirrorsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = mirrorsmtl;             

                } );

                // Add the model to the scene.
                mirrorsmesh.position.y = 300;
                scene.add( mirrorsmesh );
            });  

                var lightfittingsmtl = new THREE.MeshPhongMaterial({
                //map : ceilingtex,
                shininess : 1,
                color: 0x606060,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/newlightfittings2.obj', function ( lightfittingsmesh ) {
                            

                // For any meshes in the model, add our material.
                lightfittingsmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = lightfittingsmtl;
                                 
                    node.castShadow = true;
                    node.receiveShadow = true;             

                } );

                // Add the model to the scene.
                lightfittingsmesh.position.y = 300;
                scene.add( lightfittingsmesh );
            });  

                /*var discoballmtl = new THREE.MeshPhongMaterial({
                shininess : 500,

                //roughness : 0,
                color: 0x7B7B7B,
                specular: 0xffffff
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/discoball2.obj', function ( discoballmesh ) {
                            

                // For any meshes in the model, add our material.
                discoballmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = discoballmtl;             

                } );

                // Add the model to the scene.
                discoballmesh.position.set(-339, 586.2, 281);
                discoball = discoballmesh;
                //scene.add( discoball );
            });  */
            /*var harpsichordmtl = new THREE.MeshPhongMaterial({
                //map : ceilingtex,
                //envMap : ceilingtex,
                //roughness : 0.5,
                //metalness : 1,
                color: 0x000000,
                shininess : 100, 
                //ambient: 0x030303, 
                //specular: 0x009900,
                //refractionRatio : 0.5,
                //emissiveIntensity: 100

            });

            /loader = new THREE.OBJLoader();
            loader.load( 'assets/harpnosweat.obj', function ( harpsichordmesh ) {
                            

                // For any meshes in the model, add our material.
                harpsichordmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = harpsichordmtl;             

                } );

                // Add the model to the scene.
                harpsichordmesh.position.y = 300;
                //scene.add( harpsichordmesh );
            });   */ 

                var curtainmtl = new THREE.MeshStandardMaterial({
                map : curtaintex,
                metalness: 0,
                roughness : 1,
                color: 0x4B0000,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/curtain.obj', function ( curtainmesh ) {
                            

                // For any meshes in the model, add our material.
                curtainmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = curtainmtl;             

                } );

                // Add the model to the scene.
                curtainmesh.position.y = 300;
                scene.add( curtainmesh );
            });  

                var airconmtl = new THREE.MeshPhongMaterial({
                map : ceilingtex,
                shininess : 0,
                color: 0x1c1c1c,
                //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/aircon.obj', function ( airconmesh ) {
                            

                // For any meshes in the model, add our material.
                airconmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = airconmtl;             

                } );

                // Add the model to the scene.
                airconmesh.position.y = 300;
                scene.add( airconmesh );
            }); 

            var wiresmtl = new THREE.MeshPhongMaterial({
            map : curtaintex,
            shininess : 2,
            color: 0x260000  ,
            emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/wires.obj', function ( wiresmesh ) {
                            

                // For any meshes in the model, add our material.
                wiresmesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = wiresmtl;             

                } );

                // Add the model to the scene.
                wiresmesh.position.y = 300;
                scene.add( wiresmesh );
            });

            var stagemtl = new THREE.MeshPhongMaterial({
            //map : stagetex
            //shininess : 0,
            color: 0x210003,
            //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/stagebottom.obj', function ( stagemesh ) {
                            

                // For any meshes in the model, add our material.
                stagemesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = stagemtl;             

                } );

                // Add the model to the scene.
                stagemesh.position.y = 300;
                scene.add( stagemesh );
            });

            var fancasemtl = new THREE.MeshStandardMaterial({
            //map : stagetex
            metalness : 50,
            roughness : 0.2,
            color: 0x999999,
            //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/fancase.obj', function ( fancasemesh ) {
                            

                // For any meshes in the model, add our material.
                fancasemesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = fancasemtl;             

                } );

                // Add the model to the scene.
                fancasemesh.position.y = 300;
                scene.add( fancasemesh );
            });

            var fanblademtl = new THREE.MeshStandardMaterial({
            //map : stagetex
            metalness : 50,
            roughness : 0.2,
            color: 0x999999,
            //emissiveIntensity: 100

            });

            loader = new THREE.OBJLoader();
            loader.load( 'assets/fanblades.obj', function ( fanblademesh ) {
                            

                // For any meshes in the model, add our material.
                fanblademesh.traverse( function ( node ) {

                    if ( node.isMesh ) node.material = fanblademtl;             

                } );

                // Add the model to the scene.
                fanblademesh.position.set(-18,580,-43);
                fanblade = fanblademesh;
                scene.add( fanblade );
            });


            var cylmtl1 = new THREE.MeshPhongMaterial( {color: 0x210003, map: stagetex} );
            
            var cylgeo1 = new THREE.CylinderGeometry( 292, 292, 3, 100 );
            var stageTop = new THREE.Mesh( cylgeo1, cylmtl1 );
            stageTop.position.set(-498,345,428);
            scene.add( stageTop );

            var cylgeo2 = new THREE.CylinderGeometry( 328, 328, 3, 100 );
            var stageTop2 = new THREE.Mesh( cylgeo2, cylmtl1 );
            stageTop2.position.set(-498,328,428);
            scene.add( stageTop2 );

            //stagelight
            testLight7 = new THREE.PointLight(0xc603fc, 5, 300);//750
            testLight7.position.set(-498,302,428);
            //testLight6.castShadow = true;
            //testLight7.shadow.camera.near = 100;
            //testLight7.shadow.camera.far = 1000;

            //scene.add(testLight7);

          
            
            camera.position.set(400, player.height, -500);
            camera.lookAt(new THREE.Vector3(0,player.height,0));
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            renderer.setSize( window.innerWidth, window.innerHeight );
            
            document.body.appendChild(renderer.domElement);

            //var controls = new OrbitControls( camera, renderer.domElement );

            //if (window.DeviceOrientationEvent) {
                //onHandset = true //change
            //}

            if ( onHandset == true){
                camera.position.set(600, 400, -500);

                var controls = new THREE.OrbitControls( camera, renderer.domElement );
                controls.target = new THREE.Vector3(0,440,0);
                //controls.minDistance = 0;
                controls.maxDistance = 300;
                camera.lookAt(new THREE.Vector3(-400, 450, 300));

                //controls.update() must be called after any manual changes to the camera's transform
                //camera.position.set( 0, 20, 100 );
                controls.update();

            }

            console.log(onHandset);
            //animate();
        };

        function animate(){
            requestAnimationFrame(animate);

            //fanblade.rotation.y += 0.01;

            //var gyroPresent = false;
            //window.addEventListener("devicemotion", function(event){
            //    if(event.rotationRate.alpha || event.rotationRate.beta || event.rotationRate.gamma) {
            //        gyroPresent = true
            //    } 
            //    else {gyroPresent = false};
            //}
            //);

            //if (window.DeviceOrientationEvent) {
            //    gyroPresent = true
            //}

            //var ua = new UAParser();
            //var result = ua.getResult();
            //console.log(result);
//
//
            //console.log(result.browser);
            //console.log(result.device);
            //console.log(result.os);

            if ( onHandset == false ) {
                
                // Keyboard movement inputs
                if(keyboard[87]){ // W key
                    camera.position.x -= Math.sin(camera.rotation.y) * player.speed;
                    camera.position.z -= -Math.cos(camera.rotation.y) * player.speed;
                }
                if(keyboard[83]){ // S key
                    camera.position.x += Math.sin(camera.rotation.y) * player.speed;
                    camera.position.z += -Math.cos(camera.rotation.y) * player.speed;
                }
                if(keyboard[65]){ // A key
                    // Redirect motion by 90 degrees
                    camera.position.x += Math.sin(camera.rotation.y + Math.PI/2) * player.speed;
                    camera.position.z += -Math.cos(camera.rotation.y + Math.PI/2) * player.speed;
                }
                if(keyboard[68]){ // D key
                    camera.position.x += Math.sin(camera.rotation.y - Math.PI/2) * player.speed;
                    camera.position.z += -Math.cos(camera.rotation.y - Math.PI/2) * player.speed;
                }
                
                // Keyboard turn inputs
                if(keyboard[37]){ // left arrow key
                    camera.rotation.y -= player.turnSpeed;
                }
                if(keyboard[39]){ // right arrow key
                    camera.rotation.y += player.turnSpeed;
                }
            } else if ( onHandset == true) {
                //controls.update();

            }
            
            renderer.render(scene, camera);
        }

        function keyDown(event){
            keyboard[event.keyCode] = true;
        }

        function keyUp(event){
            keyboard[event.keyCode] = false;
        }

        window.addEventListener('keydown', keyDown);
        window.addEventListener('keyup', keyUp);

        //window.onload = init;

    var startButton = document.getElementById( 'startButton' );
		startButton.addEventListener( 'click', function () {


			init();
			animate();


		}, false );
        

    </script>
</body>
</html>